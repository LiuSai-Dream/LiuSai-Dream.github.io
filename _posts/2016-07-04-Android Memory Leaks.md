---
layout: post
title: Andriod 内存泄漏
category: Android
---

## Java 内存分配策略
java运行时的内存分配策略：静态分配、栈式分配、堆式分配。对应的内存空间：静态存储区（方法区），栈区，堆区。

- 静态存储区（方法区）：主要存放**静态数据**、**全局static数据**和**常量**。该内存在程序编译时就已经分配好，并且在程序的运行期间都存在。（是不是还要存储方法？）
- 栈区：**当方法执行时**，方法内的局部变量在栈上创建，并在方法执行结束时这些局部变量所持有的内存被释放。
- 堆区：动态内存分配，程序运行时直接new出来的内存。该部分内存由java 垃圾回收期回收。

栈与堆的区别：
方法体内定义的（局部变量）在栈内存中分配。

堆存放所有**new出来的对象**（包括该对象的成员变量）和**数组**。在堆中产生一个数组或者对象后，还可以在栈中定义一个特殊的变量，该变量的取值等于数组或者对象在堆内存中的首地址。也就是引用变量。可以通过该引用变量来访问堆中的对象或数组。

例如：
```
public class Sample() {
    int s1 = 0;
    Sample mSample1 = new Sample();
    
    public void method() {
        int s2 = 1;
        Sample mSample2 = new Sample();
    }
}

Sample mSample3 = new Sample();
```

**s2 和 mSample2都存在于栈中**（在方法中），但是mSample2指向的对象存在于堆上。
mSample3指向的对象实体位于堆上，其中包括s1 和 mSample1。而mSample3自己位于栈中。


## Java 内存泄漏的特征

这些对象是可达的；其次，这些对象是无用的。

C++的内存泄漏和java的区别：有些对象被分配了内存空间，然后却不可达，由于C++中没有GC，这些内存将永远收不回来。在Java中，这些不可达的对象都由GC负责回收。

得知，对于C++，程序员需要自己管理边和顶点，而对于Java程序员只需要管理边就可以了(不需要管理顶点的释放)。

## Android 中常见的内存泄漏
